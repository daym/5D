#ifndef __EVALUATORS_H
#define __EVALUATORS_H
#include <set>
#include "AST/AST"
#include "AST/Symbol"

namespace Evaluators {
class EvaluationException : public std::exception {
	char* message;
public:
	EvaluationException(const char* s) throw();
	virtual const char* what() const throw();
};

struct Operation : AST::Node {
	virtual bool eager_P() const;
	virtual AST::Node* execute(AST::Node* argument) = 0;
};
/*typedef Operation BuiltinOperation;*/
struct BuiltinOperation : Operation {
	Operation* fallback;
	BuiltinOperation(Operation* fallback) {
		this->fallback = fallback;
	}
};
struct Reducer : BuiltinOperation {
	Reducer(Operation* fallback) : BuiltinOperation(fallback) {}
	virtual bool eager_P(void) const {
		return(true);
	}
	virtual AST::Node* execute(AST::Node* argument);
	virtual std::string str(void) const {
		return("reduce");
	}
};
extern Reducer reducer; /* never EVER make your own instance */

void get_free_variables(AST::Node* root, std::set<AST::Symbol*>& freeNames);
AST::Node* annotate(AST::Node* root);
AST::Node* reduce(AST::Node* term);
AST::Node* close(AST::Symbol* parameter, AST::Node* argument, AST::Node* body);
bool abstraction_P(AST::Node* root);
bool application_P(AST::Node* root);
};

#endif /*ndef __EVALUATORS_H*/
