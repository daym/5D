#ifndef __EVALUATORS_H
#define __EVALUATORS_H
#include <set>
#include "AST/AST"
#include "AST/Symbol"

namespace Evaluators {
class EvaluationException : public std::exception {
	char* message;
public:
	EvaluationException(const char* s) throw();
	virtual const char* what() const throw();
};

struct Reducer : AST::Operation {
	Reducer(void) {}
	virtual bool eager_P(void) const {
		return(true);
	}
	virtual AST::Node* execute(AST::Node* argument);
	virtual std::string str(void) const {
		return("reduce");
	}
};
extern Reducer reducer; /* never EVER make your own instance */

void get_free_variables(AST::Node* root, std::set<AST::Symbol*>& freeNames);
AST::Node* annotate(AST::Node* root);
AST::Node* reduce(AST::Node* term);
AST::Node* close(AST::Symbol* parameter, AST::Node* argument, AST::Node* body);
AST::Node* makeError(const char* reason);
bool define_P(AST::Node* input);
AST::Node* programFromSExpression(AST::Node* root);
AST::Node* evaluate(AST::Node* input);
AST::Cons* evaluateToCons(AST::Node* input);
AST::Node* listFromStr(AST::Str* node);
int increaseGeneration(void);

};

#endif /*ndef __EVALUATORS_H*/
